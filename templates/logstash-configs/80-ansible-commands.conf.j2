filter {
  if [type] == "syslog" {
    grok {
      # When Ansible is run with pipelining=True, the module for the task is obfuscated as "ansible-<stdin>"
      # When running with pipelinine=False, the syslog entry is more informative, but requires a different pattern.
      match => { "message" => "%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME:host_target} ansible-<stdin>: Invoked with (?<ansible_args>.*)" }
      add_tag => "ansible_command"
      remove_tag => "_grokparsefailure"
    }
  }
}
